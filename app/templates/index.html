<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>An치lisis de Inventario - SEVENTEEN PER칔</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/logo.png') }}" />
    <link rel="shortcut icon" href="{{ url_for('static', filename='img/logo.png') }}" />
    <meta name="description" content="Dashboard de an치lisis inteligente de inventario" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: {
                50: "#f0f9ff", 100: "#e0f2fe", 200: "#bae6fd",
                300: "#7dd3fc", 400: "#38bdf8", 500: "#0c4a6e",
                600: "#0c4a6e", 700: "#0c4a6e", 800: "#075985", 900: "#0c4a6e",
              },
            },
          },
        },
      };
    </script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

    <!-- Custom Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}" />
  </head>
  <body class="text-slate-700">
    <!-- Header -->
    {% include 'partials/header.html' %}

    <!-- Upload Progress Modal -->
    <div id="upload-modal" class="modal-overlay hidden">
      <div class="modal-content">
        <div class="loader mx-auto mb-4"></div>
        <h3 id="upload-title" class="text-lg font-semibold text-slate-700 mb-2">Subiendo archivo...</h3>
        <p id="upload-status" class="text-sm text-slate-500 mb-2">Preparando carga</p>
        <div class="progress-bar">
          <div id="upload-progress" class="progress-fill" style="width: 0%"></div>
        </div>
        <p id="upload-percent" class="text-sm text-slate-400 mt-2">0%</p>
      </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-6 py-8 flex-1">
      <!-- Empty State -->
      <div id="empty-state" class="flex flex-col items-center justify-center h-[60vh]">
        <div class="text-center">
          <div class="text-7xl mb-6">游늵</div>
          <h2 class="text-2xl font-bold text-slate-700 mb-3">Analiza tu inventario</h2>
          <p class="text-slate-500 mb-6 max-w-md">
            Sube tu archivo Excel de inventario para generar el an치lisis completo con gr치ficos e indicadores.
          </p>
          <label class="px-6 py-3 bg-[#0c4a6e] hover:bg-[#0a3d5c] rounded-lg text-white font-medium cursor-pointer inline-flex items-center gap-2 transition-colors">
            <i class="fa-solid fa-file-excel"></i>
            Subir archivo Excel
            <input type="file" accept=".xlsx,.xls" onchange="uploadExcel(event)" class="hidden" />
          </label>
          <p class="text-xs text-slate-400 mt-3">Formatos soportados: .xlsx, .xls (m치x. 250MB)</p>
        </div>
      </div>

      <!-- Loading State -->
      <div id="loading-state" class="flex flex-col items-center justify-center h-[60vh] hidden">
        <div class="loader mb-4"></div>
        <p class="text-slate-500">Cargando an치lisis de inventario...</p>
      </div>

      <!-- Dashboard Content -->
      <div id="dashboard-content" class="hidden space-y-8">
        <!-- KPI Cards -->
        <section id="kpi-section">
          <h2 class="section-title">
            <i class="fa-solid fa-chart-column"></i>
            Indicadores principales
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="kpi-grid"></div>
        </section>

        <!-- Charts Row -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Top Proveedores -->
          <div class="card">
            <h3 class="section-title">
              <i class="fa-solid fa-truck"></i>
              Top proveedores por valor
            </h3>
            <div class="h-64">
              <canvas id="suppliers-chart"></canvas>
            </div>
          </div>

          <!-- Categories -->
          <div class="card">
            <h3 class="section-title">
              <i class="fa-solid fa-layer-group"></i>
              Valor por categor칤a
            </h3>
            <div id="categories-chart-container" class="overflow-y-auto" style="height: 280px">
              <canvas id="categories-chart"></canvas>
            </div>
          </div>
        </section>

        <!-- Top Products & Alerts Table -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="card">
            <h3 class="section-title">
              <i class="fa-solid fa-coins"></i>
              Top productos por valor
            </h3>
            <div class="overflow-x-auto max-h-80 overflow-y-auto" id="top-products-table"></div>
          </div>
          <div class="card">
            <h3 class="section-title">
              <i class="fa-solid fa-triangle-exclamation text-red-500"></i>
              Productos en alerta
            </h3>
            <div class="overflow-x-auto max-h-80 overflow-y-auto" id="alerts-table"></div>
          </div>
        </section>

        <!-- Brands Chart -->
        <section class="card">
          <h3 class="section-title">
            <i class="fa-solid fa-tags"></i>
            Top marcas por valor de inventario
          </h3>
          <div class="h-72">
            <canvas id="brands-chart"></canvas>
          </div>
        </section>

        <!-- Estado del Stock -->
        <section id="alerts-section">
          <h2 class="section-title">
            <i class="fa-solid fa-boxes-stacked"></i>
            Estado del stock
          </h2>
          <div class="card" id="stock-status-panel"></div>
        </section>

        <!-- Search Section -->
        <section class="card">
          <h3 class="section-title">
            <i class="fa-solid fa-magnifying-glass"></i>
            B칰squeda de productos
          </h3>
          <div class="flex flex-wrap gap-3 mb-4">
            <input type="text" id="search-input" placeholder="Buscar por SKU, producto..."
              class="flex-1 min-w-[180px] px-4 py-2 bg-slate-50 border border-slate-200 rounded-lg text-slate-700 placeholder-slate-400 focus:ring-2 focus:ring-[#0c4a6e] focus:border-transparent text-sm" />
            <select id="filter-category" onchange="populateBrandFilter(); searchProducts(1)"
              class="px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-slate-700 text-sm">
              <option value="">Todas las categor칤as</option>
            </select>
            <select id="filter-brand" onchange="searchProducts(1)"
              class="px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-slate-700 text-sm max-w-[200px]">
              <option value="">Todas las marcas</option>
            </select>
            <select id="filter-status" onchange="searchProducts(1)"
              class="px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-slate-700 text-sm">
              <option value="">Todos los estados</option>
              <option value="negative">游댮 Stock Negativo</option>
              <option value="out_of_stock">游 Sin Stock</option>
              <option value="critical">游리 Cr칤tico</option>
              <option value="low">游릭 Bajo</option>
              <option value="optimal">游릭 칍ptimo</option>
              <option value="overstock">游댯 Exceso</option>
            </select>
            <select id="items-per-page" onchange="searchProducts(1)"
              class="px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-slate-700 text-sm">
              <option value="10">10 por p치gina</option>
              <option value="20" selected>20 por p치gina</option>
              <option value="50">50 por p치gina</option>
              <option value="100">100 por p치gina</option>
            </select>
            <button onclick="searchProducts(1)"
              class="px-5 py-2 bg-[#37b6fb] hover:bg-[#1da1e6] rounded-lg text-white font-medium text-sm">
              Buscar
            </button>
          </div>
          <div class="flex flex-wrap gap-3 mb-4 items-center">
            <span class="text-xs text-slate-400 font-medium">Ordenar por:</span>
            <select id="sort-date" onchange="searchProducts(1)"
              class="px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-slate-700 text-sm">
              <option value="">游늰 Fecha</option>
              <option value="date_desc">M치s recientes</option>
              <option value="date_asc">M치s antiguos</option>
            </select>
            <select id="sort-stock" onchange="searchProducts(1)"
              class="px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-slate-700 text-sm">
              <option value="">游닍 Stock</option>
              <option value="stock_desc">Mayor stock</option>
              <option value="stock_asc">Menor stock</option>
            </select>
            <select id="sort-value" onchange="searchProducts(1)"
              class="px-3 py-2 bg-slate-50 border border-slate-200 rounded-lg text-slate-700 text-sm">
              <option value="">游눯 Valor</option>
              <option value="value_desc">Mayor valor</option>
              <option value="value_asc">Menor valor</option>
            </select>
          </div>
          <div id="search-results" class="overflow-x-auto"></div>
          <div id="pagination-container" class="flex justify-between items-center mt-4 hidden">
            <p id="results-info" class="text-sm text-slate-500"></p>
            <div id="pagination-buttons" class="flex gap-2"></div>
          </div>
        </section>
      </div>
    </main>

    <!-- Footer -->
    {% include 'partials/footer.html' %}

    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
  </body>
</html>
